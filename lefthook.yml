post-merge:
  commands:
    pnpm-install:
      run: |
        set -euo pipefail

        if git rev-parse --verify ORIG_HEAD >/dev/null 2>&1; then
          BASE="ORIG_HEAD"
        else
          BASE="HEAD~1"
        fi

        CHANGED="$(git diff --name-only "$BASE" HEAD || true)"

        if echo "$CHANGED" | grep -qE '^(pnpm-lock\.yaml|pnpm-workspace\.yaml|package\.json|apps/[^/]+/package\.json|packages/[^/]+/package\.json)$'; then
          pnpm install
        else
          echo "post-merge: no dependency files changed; skipping pnpm install"
        fi

pre-commit:
  parallel: true
  commands:
    prettier:
      glob: "*.{ts,tsx,js,jsx,cjs,mjs,json,md,yml,yaml,css,scss}"
      run: pnpm -w exec prettier --write {staged_files}
      stage_fixed: true

    eslint:
      glob: "*.{ts,tsx,js,jsx,cjs,mjs}"
      run: node scripts/lefthook/lint-staged.mjs {staged_files}

    typecheck:
      glob: "*.{ts,tsx}"
      run: node scripts/lefthook/typecheck-staged.mjs {staged_files}

commit-msg:
  commands:
    commitlint:
      run: pnpm exec commitlint --edit {1}
